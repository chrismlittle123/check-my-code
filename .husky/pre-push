#!/bin/sh

echo "ğŸš€ Running pre-push checks..."

# 1. Type-check
echo "ğŸ“ TypeScript type-check..."
npm run typecheck
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type-check failed!"
  exit 1
fi

# 2. Lint
echo "ğŸ” ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint failed!"
  exit 1
fi

# 3. Build
echo "ğŸ”¨ Build..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed!"
  exit 1
fi

# 4. cmc audit - verify linter configs match cmc.toml
echo "ğŸ” cmc audit..."
node dist/cli/index.js audit 2>/dev/null || true

# 5. cmc check - verify code follows standards
echo "ğŸ“‹ cmc check src/..."
node dist/cli/index.js check src/
if [ $? -ne 0 ]; then
  echo "âŒ cmc check failed - code violates standards!"
  exit 1
fi

# 6. Unit tests
echo "ğŸ§ª Running unit tests..."
npm run test:unit
if [ $? -ne 0 ]; then
  echo "âŒ Unit tests failed!"
  exit 1
fi

# 7. Knip - check for unused code
echo "ğŸ”¬ Checking for unused code (knip)..."
npm run knip
if [ $? -ne 0 ]; then
  echo "âŒ Knip found unused code!"
  exit 1
fi

echo "âœ… All checks passed!"
