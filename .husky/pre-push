#!/bin/sh

# =============================================================================
# Pre-push hook
# =============================================================================
# This hook runs before pushing to ensure the full codebase is valid.
# It runs more comprehensive checks than pre-commit since pushing is less frequent.
#
# What it does:
# 1. Full TypeScript type-check
# 2. Full ESLint check (not just staged files)
# 3. All tests
# 4. Build verification
#
# To bypass (use sparingly): git push --no-verify
# =============================================================================

echo "ğŸš€ Running pre-push checks..."

# 1. Type-check
echo "ğŸ“ Running TypeScript type-check..."
npm run typecheck
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type-check failed!"
  exit 1
fi

# 2. Full lint
echo "ğŸ” Running ESLint on entire codebase..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint check failed!"
  exit 1
fi

# 3. Dead code detection
echo "ğŸ” Checking for dead code..."
npm run dead-code
if [ $? -ne 0 ]; then
  echo "âŒ Dead code detected! Run 'npm run dead-code' to see details."
  exit 1
fi

# 5. Run tests
echo "ğŸ§ª Running tests..."
npm run test:run
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed!"
  exit 1
fi

# 6. Build
echo "ğŸ”¨ Verifying build..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed!"
  exit 1
fi

echo "âœ… All pre-push checks passed! Safe to push."
