# v1.5.0 PRD: Colored Output & Quiet Mode

## Overview

Version 1.5.0 focuses on two targeted CLI improvements that enhance the user experience without adding complexity:

1. **Colored terminal output** - Visual distinction between errors, warnings, and success messages
2. **`--quiet` flag** - Minimal output mode for CI/CD and scripting

## Features

### 1. Colored Terminal Output

#### Description

Add ANSI color support to terminal output for all commands that produce user-facing messages. Colors improve readability and help users quickly identify the nature of output.

#### Color Scheme

| Element           | Color    | ANSI Code  |
| ----------------- | -------- | ---------- |
| Violations/errors | Red      | `\x1b[31m` |
| Warnings          | Yellow   | `\x1b[33m` |
| Success messages  | Green    | `\x1b[32m` |
| File paths        | Cyan     | `\x1b[36m` |
| Linter/rule names | Dim/gray | `\x1b[90m` |
| Reset             | -        | `\x1b[0m`  |

#### Implementation Details

**New file: `src/cli/output.ts`**

Create a centralized output utility that handles:

- Color formatting functions (`red()`, `green()`, `yellow()`, `cyan()`, `dim()`)
- TTY detection to disable colors when output is piped (`process.stdout.isTTY`)
- Respect `NO_COLOR` environment variable (standard: https://no-color.org/)
- Respect `FORCE_COLOR` environment variable to force colors

```typescript
// Example API
import { colors } from "./output.js";

console.log(colors.red("Error: Missing config"));
console.log(colors.green("✓ No violations found"));
console.log(
  `${colors.cyan("src/main.ts")}:10 ${colors.dim("[eslint/no-console]")} ${message}`,
);
```

**No external dependencies** - Use built-in ANSI codes. Node.js 20+ handles this well natively.

#### Affected Commands

| Command    | Changes                                                                     |
| ---------- | --------------------------------------------------------------------------- |
| `check`    | Violations in red, success in green, file paths in cyan, linter/rule in dim |
| `audit`    | Mismatches in red, matches in green                                         |
| `validate` | Errors in red, success in green                                             |
| `generate` | Success in green, overwrites in yellow                                      |
| `context`  | Success in green                                                            |

#### Example Output

**Before (current):**

```
src/main.ts:10 [eslint/no-console] Unexpected console statement
src/utils.ts:5 [eslint/no-unused-vars] 'foo' is defined but never used

✗ 2 violations found
```

**After (v1.5.0):**

```
src/main.ts:10 [eslint/no-console] Unexpected console statement    <- cyan:red:dim:white
src/utils.ts:5 [eslint/no-unused-vars] 'foo' is defined but never used

✗ 2 violations found    <- red
```

```
✓ No violations found (15 files checked)    <- green
```

### 2. `--quiet` Flag

#### Description

Add a `--quiet` (or `-q`) flag to `cmc check` that suppresses all output. The command communicates results only through exit codes.

#### Use Cases

- CI/CD pipelines where output is logged elsewhere
- Scripts that only need pass/fail status
- Combining with other tools that parse exit codes
- Reducing noise in automated workflows

#### Implementation Details

**Changes to `src/cli/commands/check.ts`:**

```typescript
.option('-q, --quiet', 'Suppress all output (exit code only)', false)
```

When `--quiet` is set:

- Skip all `console.log()` calls in `outputResults()`
- Still run all linters and checks normally
- Exit with appropriate code (0 = success, 1 = violations, 2 = config error, 3 = runtime error)

**Interaction with `--json`:**

If both `--quiet` and `--json` are provided, `--quiet` takes precedence (no output).

#### Example Usage

```bash
# Silent check, only care about exit code
cmc check --quiet && echo "Passed" || echo "Failed"

# Use in CI conditional
if cmc check -q; then
  npm publish
fi

# Combine with other commands
cmc check --quiet && npm run build
```

## Technical Specifications

### Exit Codes (unchanged)

| Code | Meaning                 |
| ---- | ----------------------- |
| 0    | Success (no violations) |
| 1    | Violations found        |
| 2    | Configuration error     |
| 3    | Runtime error           |

### Environment Variables

| Variable      | Effect                               |
| ------------- | ------------------------------------ |
| `NO_COLOR`    | Disable all color output (any value) |
| `FORCE_COLOR` | Force color output even when not TTY |

### Backwards Compatibility

- Default behavior unchanged (colors only add visual enhancement)
- `--json` output format unchanged
- Exit codes unchanged
- No breaking changes to existing workflows

## File Changes

### New Files

- `src/cli/output.ts` - Color formatting utilities

### Modified Files

- `src/cli/commands/check.ts` - Add `--quiet` flag, use colors
- `src/cli/commands/audit.ts` - Use colors
- `src/cli/commands/validate.ts` - Use colors
- `src/cli/commands/generate.ts` - Use colors
- `src/cli/commands/context.ts` - Use colors

## Testing

### Unit Tests

**`tests/unit/output.test.ts`:**

- Color functions produce correct ANSI codes
- `NO_COLOR` env var disables colors
- `FORCE_COLOR` env var enables colors
- Non-TTY defaults to no colors

### E2E Tests

**`tests/e2e/check.test.ts`:**

- Add tests for `--quiet` flag
- Verify no stdout when `--quiet` is used
- Verify exit codes still work correctly with `--quiet`

### Manual Testing

- Verify colors display correctly in various terminals (iTerm2, Terminal.app, VS Code terminal)
- Verify colors disabled when piping output (`cmc check | cat`)
- Verify `NO_COLOR=1 cmc check` produces no colors

## Rollout

1. Implement `src/cli/output.ts` with color utilities
2. Add `--quiet` flag to check command
3. Update check command to use colors
4. Update other commands to use colors
5. Add unit tests for output module
6. Add E2E tests for `--quiet` flag
7. Update CHANGELOG.md
8. Release v1.5.0

## Out of Scope (deferred to v1.7.x)

- Progress indicators for large projects
- File count in violation output
- `--verbose` flag for detailed linter execution info
- Better error messages with actionable suggestions
